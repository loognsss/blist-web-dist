import{b as Q,d as ce,b2 as W,e1 as de,e2 as ue,G,q as d,r as ge,y as e,V as he,N as V,O as H,K as J,U as me,a3 as fe,a4 as O,a6 as we,S as K,a9 as h,ag as be,aa as X,L as pe,c$ as xe,an as B,P as _e,aG as Y,au as $e,cx as ke,dI as ve,am as ye,cX as Ce,cA as je,aO as Me,ap as Se,aq as Oe,aF as Pe,_ as P,bM as m,e3 as Le,o as Ie,aN as Ae}from"./index-222e4ced.js";import{L as Be,c as f}from"./List-96f9c85d.js";import{T as qe,c as ze}from"./index-cc75bcf0.js";import Ee from"./Password-7d69961d.js";import{u as Fe}from"./helper-8418b431.js";import{g as Te}from"./icon-a985ffeb.js";import{x as L,w as Ue,b as Re}from"./style-f3c4ee5c.js";import"./obj-55ba4412.js";import"./Layout-7795e137.js";import"./useTitle-ebc29c4b.js";import"./FolderTree-af1ede02.js";import"./index-6da0db64.js";import"./index-53abd33a.js";import"./icons-ed8188ca.js";import"./index-452231f0.js";function De(){let n=!1,i=[];return{acquire:()=>new Promise(a=>{n?i.push(a):(n=!0,a())}),release:()=>{i.length>0?i.shift()():n=!1}}}const Z=n=>{window.open(n,"_blank")},Ne=n=>{const{show:i}=Re({id:2}),{isMouseSupported:a}=Fe(),u=()=>Ie.list_item_filename_overflow;return e(ye.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(B,{class:"list-item viselect-item",get"data-index"(){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:_e()}},get cursor(){return a()?"default":"pointer"},"on:click":w=>{n.obj.is_dir?n.jumpCallback():n.url&&Z(n.url)},onContextMenu:w=>{i(w,{props:n})},get children(){return[e(B,{class:"name-box",spacing:"$1",get w(){return f[0].w},get children(){return[e(Y,{class:"icon",boxSize:"$6",get color(){return $e()},get as(){return Te(n.obj)},mr:"$1"}),e(h,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:u()==="multi_line"?"unset":"nowrap","overflow-x":u()==="scrollable"?"auto":"hidden",textOverflow:u()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(h,{class:"size",get w(){return f[1].w},get textAlign(){return f[1].textAlign},get children(){return ke(n.obj.size)}}),e(h,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return f[2].w},get textAlign(){return f[2].textAlign},get children(){return ve(n.obj.modified)}})]}})}})},I={extract:{icon:qe,color:"$success9"},copy_link:{icon:ze,color:"$info9"},download:{icon:Ae,color:"$primary9"}},We=()=>{const{copy:n}=Ce(),{colorMode:i}=je();return e(Ue,{id:2,animation:"scale",get theme(){return i()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(L,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{Z(a.url)},get children(){return e(A,{name:"download"})}}),e(L,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{n(a.url)},get children(){return e(A,{name:"copy_link"})}}),e(L,{hidden:()=>{const a=Me.findIndex(u=>u==="decompress");return!Se.can(Oe(),a)},onClick:({props:a})=>{Pe.emit("extract",JSON.stringify({inner:a.innerPath,pass:a.pass}))},get children(){return e(A,{name:"extract"})}})]}})},A=n=>{const i=Q();return e(B,{spacing:"$2",get children(){return[e(Y,{get p(){return I[n.name].p?"$1":void 0},get as(){return I[n.name].icon},boxSize:"$7",get color(){return I[n.name].color}}),e(h,{get children(){return i("home.toolbar.".concat(n.name))}})]}})},ot=()=>{const n=Q(),{pathname:i}=ce(),[a,u]=W(de),[w,q]=W(ue),ee=G(()=>a()||w());let l="",$="",k="",b=null;const[v,p]=d(""),[te,z]=d(!1),[y,C]=d(!1),[E,re]=d(""),[c,j]=d([]),[M,F]=d(),[ne,T]=d(!1),[ae,U]=d(""),g=De(),x=r=>{let s={};return r.forEach(t=>{s[t.name]={...t,children:t.children?x(t.children):null}}),s},S=r=>r.code===200?!1:(r.code===202?m(()=>{l!==""&&z(!0),C(!0),p("")}):p(r.message),!0),R=async r=>{if(await g.acquire(),y()&&l==="")return g.release(),[];if($===""){const t=await u(i(),P(),l);if(S(t))return g.release(),[];if(t.data.content!==null&&(b=x(t.data.content)),$=t.data.raw_url,k=t.data.sign,re(t.data.comment),t.data.sort!==void 0){let o;t.data.sort.order_by!==""&&(o=t.data.sort.order_by);let _=t.data.sort.order_direction==="desc",le=t.data.sort.extract_folder;m(()=>{F(o),T(_),U(le)})}if(t.data.encrypted&&l==="")return m(()=>{C(!0),p("")}),g.release(),[]}if(b===null){const t=await q(i(),P(),l,"/");if(S(t))return g.release(),[];b=x(t.data.content)}let s=b;for(let t=0;t<r.length;t++){if(s[r[t]].children===null){const o=await q(i(),P(),l,"/"+r.slice(0,t+1).join("/"));if(S(o))return g.release(),[];s[r[t]].children=x(o.data.content)}s=s[r[t]].children}return m(()=>{C(!1),z(!1),p("")}),g.release(),Object.values(s)},[se,D]=d([]);ge(()=>{R(c()).then(r=>D(r))});const N=()=>{R(c()).then(r=>D(r))};N();const oe=()=>{let r=se();M()&&(r=r.sort((t,o)=>(ne()?-1:1)*Le(t[M()],o[M()])));let s=ae();if(s!==""){let t=[],o=[];r.forEach(_=>(_.is_dir?t:o).push(_)),r=s==="front"?t.concat(o):o.concat(t)}return r},ie=(r,s)=>{m(()=>{U(""),F(r),s!==void 0&&T(s)})};return e(X,{spacing:"$2",w:"$full",get children(){return[e(he,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(V,{get children(){return e(H,{get currentPage(){return c().length===0},"on:click":()=>j([]),children:"."})}}),e(J,{get each(){return c()},children:(r,s)=>e(V,{get children(){return[e(me,{}),e(H,{get currentPage(){return c().length===s()+1},"on:click":()=>j(c().slice(0,s()+1)),children:r})]}})})]}}),e(fe,{get children(){return[e(O,{get when(){return v()!==""},get children(){return e(we,{get msg(){return v()},disableColor:!0})}}),e(O,{get when(){return y()},get children(){return e(Ee,{get title(){return n("home.toolbar.archive.input_password")},password:()=>l,setPassword:r=>l=r,enterCallback:()=>N(),get children(){return e(K,{get when(){return te()},get children(){return e(h,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(O,{get when(){return G(()=>!y())()&&v()===""},get children(){return e(be,{get loading(){return ee()},get children(){return e(X,{class:"list",w:"$full",spacing:"$1",get children(){return[e(Be,{sortCallback:ie,disableCheckbox:!0}),e(J,{get each(){return oe()},children:(r,s)=>{let t,o=(c().length>0?"/"+c().join("/"):"")+"/"+r.name;return r.is_dir||(t=$+"?inner="+pe(o,!0),l!==""&&(t=t+"&pass="+encodeURIComponent(l)),k!==""&&(t=t+"&sign="+k)),e(Ne,{obj:r,get index(){return s()},jumpCallback:()=>j(c().concat(r.name)),innerPath:o,url:t,pass:l})}}),e(We,{})]}})}})}})]}}),e(K,{get when(){return E()!==""},get children(){return[e(xe,{}),e(h,{w:"$full",pl:"$1",pr:"$1",get children(){return E()}})]}})]}})};export{ot as default};
